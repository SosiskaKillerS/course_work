{% extends "base.html" %}

{% block title %}KinoService - –ì–ª–∞–≤–Ω–∞—è{% endblock %}

{% block sidebar %}
{% if current_user.is_authenticated %}
    <aside class="sidebar">
        <form method="get" action="{{ url_for('index') }}">
            {% if search %}
                <input type="hidden" name="search" value="{{ search }}">
            {% endif %}
            <div class="filter-section">
                <h5>–ñ–∞–Ω—Ä—ã</h5>
                <div class="filter-list">
                    {% for genre in all_genres %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="genre" value="{{ genre.id }}" id="genre-{{ genre.id }}" {% if genre.id in selected_genres %}checked{% endif %}>
                            <label class="form-check-label" for="genre-{{ genre.id }}">{{ genre.name }}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="filter-section">
                <h5>–ê–∫—Ç—ë—Ä—ã</h5>
                <select name="actor" multiple class="form-select filter-select" size="6">
                    {% for actor in all_actors %}
                        <option value="{{ actor.id }}" {% if actor.id in selected_actors %}selected{% endif %}>{{ actor.name }}</option>
                    {% endfor %}
                </select>
                <small>–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö</small>
            </div>
            <div class="filter-section">
                <h5>–†–µ–∂–∏—Å—Å—ë—Ä—ã</h5>
                <select name="director" multiple class="form-select filter-select" size="6">
                    {% for director in all_directors %}
                        <option value="{{ director.id }}" {% if director.id in selected_directors %}selected{% endif %}>{{ director.name }}</option>
                    {% endfor %}
                </select>
                <small>–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö</small>
            </div>
            <div class="filter-buttons">
                <button type="submit" class="btn btn-primary">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                <a href="{{ url_for('index') }}{% if search %}?search={{ search }}{% endif %}" class="btn btn-outline-secondary">–û—á–∏—Å—Ç–∏—Ç—å</a>
            </div>
        </form>
    </aside>
{% endif %}
{% endblock %}

{% block content %}
{% if not current_user.is_authenticated %}
    <div class="container">
        <div class="access-denied fade-in">
            <div class="access-denied-icon">üîí</div>
            <h1 class="access-denied-title">–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h1>
            <p class="access-denied-text">–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å–º–∞—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
            <div class="hero-buttons">
                <a href="{{ url_for('login') }}" class="btn btn-primary">–í–æ–π—Ç–∏</a>
                <a href="{{ url_for('register') }}" class="btn btn-outline-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </div>
    </div>
{% else %}
    <div class="page-layout">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                    <h1 style="color: var(--text-primary);">–í—Å–µ —Ñ–∏–ª—å–º—ã</h1>
                    {% if current_user.role_id in [2, 3] %}
                        <a href="{{ url_for('admin_add_movie') }}" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</a>
                    {% endif %}
                </div>
                {% if search %}
                    <div class="mb-3" style="color: var(--text-secondary);">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É: <b>{{ search }}</b></div>
                {% endif %}
                {% if movies %}
                    <div class="movie-grid">
                        {% for movie in movies %}
                        <div class="movie-card fade-in">
                            {% if movie.poster_path %}
                                {% if movie.poster_path.startswith('http') %}
                                    <img src="{{ movie.poster_path }}" 
                                         alt="{{ movie.title }}" 
                                         class="movie-poster"
                                         onerror="this.src='{{ url_for('static', filename='images/superbad.jpg') }}'">
                                {% else %}
                                    <img src="{{ movie.poster_path }}" 
                                         alt="{{ movie.title }}" 
                                         class="movie-poster"
                                         onerror="this.src='{{ url_for('static', filename='images/superbad.jpg') }}'">
                                {% endif %}
                            {% else %}
                                <img src="{{ url_for('static', filename='images/superbad.jpg') }}" 
                                     alt="{{ movie.title }}" 
                                     class="movie-poster">
                            {% endif %}
                            <div class="movie-info">
                                <h3 class="movie-title">{{ movie.title }}</h3>
                                {% if movie.year %}
                                    <p class="movie-year">{{ movie.year }}</p>
                                {% endif %}
                                {% if movie.director %}
                                    <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">–†–µ–∂–∏—Å—Å—ë—Ä: {{ movie.director.name }}</p>
                                {% endif %}
                                {% if movie.genres %}
                                    <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">–ñ–∞–Ω—Ä—ã: {{ movie.genres|map(attribute='name')|join(', ') }}</p>
                                {% endif %}
                                <p class="movie-rating">‚òÖ {{ "%.1f"|format(movie.rating or 0) }}</p>
                                <a href="{{ url_for('movie_detail', movie_id=movie.id) }}" class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="card">
                        <div class="card-body text-center">
                            <h3 style="color: var(--text-primary);">–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                            <p style="color: var(--text-secondary);">–ü–æ–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Ñ–∏–ª—å–º–æ–≤.</p>
                            {% if current_user.role_id in [2, 3] %}
                                <a href="{{ url_for('admin_add_movie') }}" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ñ–∏–ª—å–º</a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </main>
    </div>
{% endif %}
{% endblock %} 